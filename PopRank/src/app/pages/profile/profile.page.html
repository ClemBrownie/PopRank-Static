<ion-header [translucent]="true">
  <ion-toolbar>
    <div class="header-content">
      <ion-img src="/assets/logo.png" alt="PopRank Logo" class="header-logo"></ion-img>
      <div class="header-title">
        <h1>PopRank</h1>
        <span class="page-subtitle">Profil</span>
      </div>
    </div>
    <ion-buttons slot="end">
      <ion-button (click)="signOut()" fill="clear">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="user">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Profil</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-refresher slot="fixed" (ionRefresh)="refreshProfile($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="page-container">
    <!-- Profil utilisateur -->
  <ion-card class="profile-card">
    <ion-card-content>
      <div class="profile-header">
        <ion-avatar class="profile-avatar">
          <ion-img [src]="user.avatarUrl || '/assets/default-avatar.png'" [alt]="user.displayName"></ion-img>
        </ion-avatar>
        <div class="profile-info">
          <h2>{{ user.displayName }}</h2>
          <p class="join-date">Membre depuis {{ user.createdAt | date:'MMMM yyyy' }}</p>
        </div>
      </div>
      
      <div class="bio-section">
        <div *ngIf="!editingBio" class="bio-display">
          <p *ngIf="user.bio; else noBio">{{ user.bio }}</p>
          <ng-template #noBio>
            <p class="no-bio">Aucune bio pour le moment</p>
          </ng-template>
          <ion-button fill="clear" size="small" (click)="startEditingBio()">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Modifier
          </ion-button>
        </div>
        
        <div *ngIf="editingBio" class="bio-edit">
          <ion-item>
            <ion-label position="stacked">Bio</ion-label>
            <ion-textarea 
              [(ngModel)]="bioText"
              placeholder="Parlez-nous de vous..."
              rows="3">
            </ion-textarea>
          </ion-item>
          <div class="bio-actions">
            <ion-button fill="clear" size="small" (click)="cancelEditingBio()">
              Annuler
            </ion-button>
            <ion-button size="small" (click)="saveBio()">
              Sauvegarder
            </ion-button>
          </div>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Statistiques -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Mes statistiques</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="stats">
        <div class="stat-item">
          <ion-text class="stat-number">{{ entries.length }}</ion-text>
          <ion-text class="stat-label">Films vus</ion-text>
        </div>
        <div class="stat-item">
          <ion-text class="stat-number">{{ getAverageRating() | number:'1.1-1' }}</ion-text>
          <ion-text class="stat-label">Note moyenne</ion-text>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Mes films -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Mes films</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div *ngIf="loading" class="loading-container">
        <ion-spinner></ion-spinner>
        <p>Chargement...</p>
      </div>

      <div *ngIf="!loading && entries.length === 0" class="empty-state">
        <div class="logo-container">
          <ion-img src="/assets/logo.png" alt="PopRank Logo" class="logo"></ion-img>
        </div>
        <p>Aucun film ajouté</p>
        <p>Commencez par rechercher un film !</p>
      </div>

      <div *ngIf="!loading && entries.length > 0" class="entries-list">
        <ion-card *ngFor="let entry of entries" class="entry-card" (click)="goToMovie(entry.movieId)">
          <ion-card-content>
            <div class="entry-content">
              <ion-img [src]="getImageUrl(entry.posterPath)" [alt]="entry.title" class="entry-poster"></ion-img>
              <div class="entry-details">
                <h3>{{ entry.title }}</h3>
                <div class="entry-meta">
                  <span class="rating">{{ getStars(entry.rating) }}{{ getEmptyStars(entry.rating) }}</span>
                  <span class="date">{{ entry.watchedAt | date:'dd/MM/yyyy' }}</span>
                </div>
                <p *ngIf="entry.review" class="review">{{ entry.review }}</p>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Section déconnexion -->
  <ion-card class="logout-card">
    <ion-card-content>
      <div class="logout-section">
        <div class="logout-info">
          <ion-icon name="log-out-outline" class="logout-icon"></ion-icon>
          <div class="logout-text">
            <h3>Déconnexion</h3>
            <p>Vous souhaitez vous déconnecter de votre compte ?</p>
          </div>
        </div>
        <ion-button 
          (click)="signOut()" 
          fill="outline" 
          color="danger"
          class="logout-button">
          <ion-icon name="log-out" slot="start"></ion-icon>
          Se déconnecter
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
  </div>
</ion-content>
